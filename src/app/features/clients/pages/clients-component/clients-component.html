<!-- ═══════════════════════════════════════════════════════════════════
     CLIENTS MODULE — Dossier Panel Dark Theme
     ═══════════════════════════════════════════════════════════════════ -->

<div class="relative max-w-7xl mx-auto px-6 py-8 space-y-10">

	<!-- ── Ambient Background Glow ── -->
	<div class="fixed top-0 left-64 right-0 h-full overflow-hidden -z-10 pointer-events-none">
		<div class="absolute -top-[20%] left-[15%] w-[500px] h-[500px] rounded-full blur-[180px] bg-indigo-600/[0.05]">
		</div>
		<div
			class="absolute bottom-[15%] right-[10%] w-[350px] h-[350px] rounded-full blur-[140px] bg-purple-600/[0.04]">
		</div>
	</div>

	<!-- ═══════════════════════ HEADER ═══════════════════════ -->
	<div class="cli-entrance flex flex-col md:flex-row md:items-end justify-between gap-6">
		<div class="space-y-2">
			<div class="flex items-center gap-3 mb-1">
				<div
					class="w-10 h-10 rounded-xl bg-indigo-500/10 border border-indigo-500/15 flex items-center justify-center text-indigo-400 shadow-lg shadow-indigo-500/5">
					<iconify-icon icon="lucide:users" width="20"></iconify-icon>
				</div>
				<div>
					<p class="text-[10px] font-semibold uppercase tracking-[0.2em] text-neutral-500">Módulo</p>
					<h1 class="cli-display-font text-2xl font-bold text-white leading-tight">Nuestros Socios</h1>
				</div>
			</div>
			<p class="text-sm text-neutral-500 max-w-md leading-relaxed pl-[52px]">
				Gestiona y monitorea a tus socios de marketing, sus tareas y entregas.
			</p>
		</div>

		<div class="flex items-center gap-3">
			<button
				class="px-5 py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-semibold text-sm shadow-lg shadow-indigo-600/20 transition-all flex items-center gap-2">
				<iconify-icon icon="lucide:user-plus" width="16"></iconify-icon>
				Nuevo Socio
			</button>

			<div class="px-4 py-2 bg-white/[0.03] border border-white/[0.06] rounded-xl">
				<span class="text-[11px] font-medium text-neutral-400 flex items-center gap-2">
					<span class="w-1.5 h-1.5 bg-indigo-400 rounded-full cli-glow-dot"></span>
					{{ clientWithTasks().length }} activos
				</span>
			</div>
		</div>
	</div>

	<!-- ═══════════════════════ STATS ROW ═══════════════════════ -->
	<div class="cli-entrance cli-entrance-delay-1 grid grid-cols-2 lg:grid-cols-4 gap-4">
		<div class="cli-stat-card cli-grain relative p-6 rounded-2xl bg-white/[0.02] border border-white/[0.06]">
			<div class="relative z-10">
				<div
					class="w-9 h-9 rounded-xl bg-indigo-500/10 flex items-center justify-center text-indigo-400 mb-4 shadow-lg shadow-indigo-500/5">
					<iconify-icon icon="lucide:users" width="18"></iconify-icon>
				</div>
				<p class="cli-display-font text-3xl font-bold text-white">{{ clientWithTasks().length }}</p>
				<p class="text-[10px] font-semibold uppercase tracking-[0.2em] text-neutral-500 mt-1">Total Socios</p>
			</div>
		</div>
		<div class="cli-stat-card cli-grain relative p-6 rounded-2xl bg-white/[0.02] border border-white/[0.06]">
			<div class="relative z-10">
				<div
					class="w-9 h-9 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-400 mb-4 shadow-lg shadow-blue-500/5">
					<iconify-icon icon="lucide:list-checks" width="18"></iconify-icon>
				</div>
				<p class="cli-display-font text-3xl font-bold text-white">{{ getTotalTasks() }}</p>
				<p class="text-[10px] font-semibold uppercase tracking-[0.2em] text-neutral-500 mt-1">Total Tareas</p>
			</div>
		</div>
		<div class="cli-stat-card cli-grain relative p-6 rounded-2xl bg-white/[0.02] border border-white/[0.06]">
			<div class="relative z-10">
				<div
					class="w-9 h-9 rounded-xl bg-emerald-500/10 flex items-center justify-center text-emerald-400 mb-4 shadow-lg shadow-emerald-500/5">
					<iconify-icon icon="lucide:check-circle-2" width="18"></iconify-icon>
				</div>
				<p class="cli-display-font text-3xl font-bold text-white">{{ getTotalApproved() }}</p>
				<p class="text-[10px] font-semibold uppercase tracking-[0.2em] text-neutral-500 mt-1">Aprobadas</p>
			</div>
		</div>
		<div class="cli-stat-card cli-grain relative p-6 rounded-2xl bg-white/[0.02] border border-white/[0.06]">
			<div class="relative z-10">
				<div
					class="w-9 h-9 rounded-xl bg-amber-500/10 flex items-center justify-center text-amber-400 mb-4 shadow-lg shadow-amber-500/5">
					<iconify-icon icon="lucide:clock" width="18"></iconify-icon>
				</div>
				<p class="cli-display-font text-3xl font-bold text-white">{{ getTotalPending() }}</p>
				<p class="text-[10px] font-semibold uppercase tracking-[0.2em] text-neutral-500 mt-1">Pendientes</p>
			</div>
		</div>
	</div>

	<!-- ═══════════════════════ SEARCH TOOLBAR ═══════════════════════ -->
	<div class="cli-entrance cli-entrance-delay-2 flex flex-col md:flex-row items-stretch md:items-center gap-4">
		<div class="relative flex-1 group">
			<iconify-icon icon="lucide:search"
				class="absolute left-4 top-1/2 -translate-y-1/2 text-neutral-600 transition-colors group-focus-within:text-indigo-400"
				width="16"></iconify-icon>
			<input type="text" placeholder="Buscar socios por nombre, empresa o teléfono..."
				(input)="onSearchChange($event)"
				class="cli-search-input w-full pl-11 pr-4 py-2.5 bg-white/[0.02] border border-white/[0.06] rounded-2xl text-sm text-neutral-300 placeholder:text-neutral-600 focus:ring-1 focus:ring-indigo-500/20 focus:border-indigo-500/20 transition-all outline-none" />
		</div>
		<button
			class="px-5 py-2.5 bg-white/[0.03] hover:bg-white/[0.06] border border-white/[0.06] hover:border-white/[0.12] text-neutral-400 hover:text-neutral-300 rounded-2xl text-sm font-medium transition-all flex items-center gap-2">
			<iconify-icon icon="lucide:sliders-horizontal" width="16"></iconify-icon>
			Filtros
		</button>
	</div>

	<!-- ═══════════════════════ CLIENT DOSSIER PANELS ═══════════════════════ -->
	<div class="cli-entrance cli-entrance-delay-3 space-y-6">

		@for (item of filteredClients(); track item.cliente.id_cliente) {
		<div
			class="cli-dossier group relative bg-white/[0.012] border border-white/[0.05] rounded-2xl overflow-hidden cli-grain">

			<!-- ── DOSSIER LAYOUT: Profile Sidebar + Tasks ── -->
			<div class="flex flex-col lg:flex-row relative z-10">

				<!-- ════════ LEFT: Client Profile Sidebar ════════ -->
				<div
					class="cli-profile-sidebar lg:w-[320px] xl:w-[360px] shrink-0 p-6 lg:border-r border-white/[0.05] space-y-5">

					<!-- Avatar + Name -->
					<div class="flex items-start gap-4">
						<div
							class="cli-avatar w-14 h-14 rounded-2xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-lg font-bold shadow-lg shadow-indigo-500/20 shrink-0">
							{{ item.cliente.nombres.charAt(0) }}{{ item.cliente.apellidos.charAt(0) }}
						</div>
						<div class="flex-1 min-w-0">
							<h3
								class="cli-display-font text-lg font-bold text-white group-hover:text-indigo-400 transition-colors leading-tight">
								{{ item.cliente.nombres }} {{ item.cliente.apellidos }}
							</h3>
							<p class="text-[11px] text-neutral-500 font-medium mt-1 flex items-center gap-1.5">
								<iconify-icon icon="lucide:building-2" width="12"
									class="text-neutral-600"></iconify-icon>
								{{ item.cliente.nombre_empresa || 'Sin empresa asignada' }}
							</p>
						</div>
					</div>

					<!-- Divider -->
					<div class="w-full h-px bg-gradient-to-r from-white/[0.08] via-white/[0.04] to-transparent"></div>

					<!-- Contact Details -->
					<div class="space-y-3">
						<p class="text-[9px] font-black uppercase tracking-[0.2em] text-neutral-600">Datos de Contacto
						</p>
						<div class="space-y-2">
							<!-- Phone -->
							<div class="flex items-center gap-3">
								<div
									class="w-8 h-8 rounded-lg bg-white/[0.03] border border-white/[0.06] flex items-center justify-center shrink-0">
									<iconify-icon icon="lucide:phone" width="14"
										class="text-neutral-500"></iconify-icon>
								</div>
								<div>
									<p class="text-[9px] font-bold uppercase tracking-widest text-neutral-600">Teléfono
									</p>
									<p class="text-[12px] text-neutral-300 font-medium">{{ item.cliente.telefono }}</p>
								</div>
							</div>
							<!-- DNI -->
							@if(item.cliente.dni) {
							<div class="flex items-center gap-3">
								<div
									class="w-8 h-8 rounded-lg bg-white/[0.03] border border-white/[0.06] flex items-center justify-center shrink-0">
									<iconify-icon icon="lucide:id-card" width="14"
										class="text-neutral-500"></iconify-icon>
								</div>
								<div>
									<p class="text-[9px] font-bold uppercase tracking-widest text-neutral-600">DNI</p>
									<p class="text-[12px] text-neutral-300 font-medium">{{ item.cliente.dni }}</p>
								</div>
							</div>
							}
							<!-- Registration Date -->
							<div class="flex items-center gap-3">
								<div
									class="w-8 h-8 rounded-lg bg-white/[0.03] border border-white/[0.06] flex items-center justify-center shrink-0">
									<iconify-icon icon="lucide:calendar-days" width="14"
										class="text-neutral-500"></iconify-icon>
								</div>
								<div>
									<p class="text-[9px] font-bold uppercase tracking-widest text-neutral-600">Registro
									</p>
									<p class="text-[12px] text-neutral-300 font-medium">{{ item.cliente.fecha_registro |
										date:'dd/MM/yyyy':'UTC' }}</p>
								</div>
							</div>
						</div>
					</div>

					<!-- Social Links -->
					@if(item.cliente.tiktok || item.cliente.instagram) {
					<div class="space-y-3">
						<p class="text-[9px] font-black uppercase tracking-[0.2em] text-neutral-600">Redes Sociales</p>
						<div class="flex gap-2">
							@if(item.cliente.tiktok) {
							<a [href]="item.cliente.tiktok" target="_blank"
								class="cli-social-icon flex items-center gap-2 px-3 py-2 rounded-xl bg-white/[0.03] border border-white/[0.06] hover:bg-white/[0.06] hover:border-white/[0.12] transition-all">
								<iconify-icon icon="lucide:music-2" width="14" class="text-blue-400"></iconify-icon>
								<span class="text-[10px] font-semibold text-neutral-400">TikTok</span>
							</a>
							}
							@if(item.cliente.instagram) {
							<a [href]="item.cliente.instagram" target="_blank"
								class="cli-social-icon flex items-center gap-2 px-3 py-2 rounded-xl bg-white/[0.03] border border-white/[0.06] hover:bg-pink-500/10 hover:border-pink-500/20 transition-all">
								<iconify-icon icon="lucide:instagram" width="14" class="text-pink-400"></iconify-icon>
								<span class="text-[10px] font-semibold text-neutral-400">Instagram</span>
							</a>
							}
						</div>
					</div>
					}

					<!-- Task Stats Mini -->
					<div class="space-y-3">
						<p class="text-[9px] font-black uppercase tracking-[0.2em] text-neutral-600">Resumen de Tareas
						</p>
						<div class="grid grid-cols-3 gap-2">
							<div class="p-2.5 rounded-xl bg-amber-500/[0.06] border border-amber-500/10 text-center">
								<p class="cli-display-font text-lg font-bold text-amber-400">{{
									getTaskStats(item.tareas).pendiente }}
								</p>
								<p class="text-[8px] font-bold uppercase tracking-widest text-neutral-600 mt-0.5">Pend.
								</p>
							</div>
							<div
								class="p-2.5 rounded-xl bg-emerald-500/[0.06] border border-emerald-500/10 text-center">
								<p class="cli-display-font text-lg font-bold text-emerald-400">{{
									getTaskStats(item.tareas).aprobado }}
								</p>
								<p class="text-[8px] font-bold uppercase tracking-widest text-neutral-600 mt-0.5">Aprob.
								</p>
							</div>
							<div class="p-2.5 rounded-xl bg-red-500/[0.06] border border-red-500/10 text-center">
								<p class="cli-display-font text-lg font-bold text-red-400">{{
									getTaskStats(item.tareas).rechazado }}</p>
								<p class="text-[8px] font-bold uppercase tracking-widest text-neutral-600 mt-0.5">Rech.
								</p>
							</div>
						</div>
					</div>
				</div>

				<!-- ════════ RIGHT: Tasks Area ════════ -->
				<div class="flex-1 min-w-0 flex flex-col">

					<!-- Tasks Header -->
					<div class="px-6 py-4 border-b border-white/[0.04] flex items-center justify-between">
						<div class="flex items-center gap-2.5">
							<div
								class="w-7 h-7 rounded-lg bg-indigo-500/10 flex items-center justify-center text-indigo-400">
								<iconify-icon icon="lucide:clipboard-list" width="14"></iconify-icon>
							</div>
							<h4 class="text-[11px] font-bold uppercase tracking-[0.15em] text-neutral-400">
								Tareas Asignadas
							</h4>
							<span
								class="ml-1 px-2 py-0.5 rounded-full bg-indigo-500/10 text-[10px] font-bold text-indigo-400 border border-indigo-500/15">
								{{ item.tareas.length }}
							</span>
						</div>
					</div>

					<!-- Tasks Table -->
					<div class="flex-1 overflow-y-auto cli-scrollbar max-h-[450px]">
						@if (item.tareas.length > 0) {
						<!-- Table Header -->
						<div
							class="grid grid-cols-12 gap-3 px-6 py-3 border-b border-white/[0.04] bg-white/[0.01] sticky top-0 z-10">
							<div class="col-span-4">
								<p class="text-[9px] font-black uppercase tracking-[0.2em] text-neutral-600">Tarea</p>
							</div>
							<div class="col-span-2">
								<p class="text-[9px] font-black uppercase tracking-[0.2em] text-neutral-600">Estado</p>
							</div>
							<div class="col-span-3">
								<p class="text-[9px] font-black uppercase tracking-[0.2em] text-neutral-600">Responsable
								</p>
							</div>
							<div class="col-span-3 text-right">
								<p class="text-[9px] font-black uppercase tracking-[0.2em] text-neutral-600">Acciones
								</p>
							</div>
						</div>

						<!-- Task Rows -->
						@for (task of item.tareas; track task.id_tarea) {
						<div class="cli-task-row grid grid-cols-12 gap-3 px-6 py-4 border-b border-white/[0.03] items-center hover:bg-white/[0.02] transition-all"
							[ngClass]="{
                'cli-task-pendiente': task.estado !== 'subido' && task.estado !== 'aprobado' && task.estado !== 'rechazado',
                'cli-task-subido': task.estado === 'subido',
                'cli-task-aprobado': task.estado === 'aprobado',
                'cli-task-rechazado': task.estado === 'rechazado'
              }">

							<!-- Task Name + Description + Files -->
							<div class="col-span-4 min-w-0 pl-3">
								<p class="cli-display-font text-[12px] font-bold text-white truncate leading-tight">{{
									task.nombre }}
								</p>
								<p class="text-[10px] text-neutral-600 mt-1 line-clamp-1 leading-relaxed">{{
									task.descripcion }}</p>
								@if (task.archivos && task.archivos.length > 0) {
								<div class="flex flex-wrap gap-1 mt-1.5">
									@for (archivo of task.archivos; track archivo.id_archivo_cliente) {
									<a [href]="archivo.ruta" target="_blank"
										class="inline-flex items-center gap-1 px-2 py-0.5 rounded-md bg-white/[0.03] border border-white/[0.05] hover:border-indigo-500/30 text-[9px] text-neutral-500 hover:text-indigo-300 transition-all">
										<iconify-icon icon="lucide:paperclip" width="10"></iconify-icon>
										Archivo
									</a>
									}
								</div>
								}
							</div>

							<!-- Status Badge -->
							<div class="col-span-2">
								<span
									class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-lg text-[9px] font-black uppercase tracking-widest border"
									[ngClass]="{
                    'bg-blue-500/10 text-blue-400 border-blue-500/15': task.estado === 'subido',
                    'bg-emerald-500/10 text-emerald-400 border-emerald-500/15': task.estado === 'aprobado',
                    'bg-red-500/10 text-red-400 border-red-500/15': task.estado === 'rechazado',
                    'bg-amber-500/10 text-amber-400 border-amber-500/15': !['subido', 'aprobado', 'rechazado'].includes(task.estado)
                  }">
									<span class="w-1.5 h-1.5 rounded-full" [ngClass]="{
                      'bg-blue-400': task.estado === 'subido',
                      'bg-emerald-400': task.estado === 'aprobado',
                      'bg-red-400': task.estado === 'rechazado',
                      'bg-amber-400': !['subido', 'aprobado', 'rechazado'].includes(task.estado)
                    }"></span>
									{{ task.estado === 'subido' ? 'Subido' :
									task.estado === 'aprobado' ? 'Aprobada' :
									task.estado === 'rechazado' ? 'Rechazada' : 'Pendiente' }}
								</span>
							</div>

							<!-- Worker -->
							<div class="col-span-3">
								@if (task.trabajador) {
								<div class="flex items-center gap-2">
									<div
										class="w-7 h-7 rounded-lg bg-white/[0.04] border border-white/[0.06] flex items-center justify-center text-[10px] font-bold text-indigo-400/80">
										{{ task.trabajador.nombres.charAt(0) }}{{ task.trabajador.apellidos.charAt(0) }}
									</div>
									<div class="min-w-0">
										<p class="text-[11px] text-neutral-300 font-medium truncate">{{
											task.trabajador.nombres }} {{
											task.trabajador.apellidos }}</p>
									</div>
								</div>
								} @else {
								<span class="text-[10px] text-neutral-700 italic">Sin asignar</span>
								}
							</div>

							<!-- Actions -->
							<div class="col-span-3 flex justify-end gap-2">
								@if (task.estado === 'subido') {
								<hlm-alert-dialog>
									<button hlmAlertDialogTrigger hlmBtn
										class="px-3 py-1.5 text-[10px] font-bold uppercase tracking-wider rounded-lg bg-emerald-500/10 text-emerald-400 border border-emerald-500/20 hover:bg-emerald-500/20 transition-all flex items-center gap-1.5 whitespace-nowrap hover:cursor-pointer">
										<iconify-icon icon="lucide:check" width="12"></iconify-icon>
										Aprobar
									</button>
									<hlm-alert-dialog-content *brnAlertDialogContent="let ctx"
										class="border border-indigo-500/20 bg-[#0c0d14] shadow-lg shadow-indigo-950/20">
										<hlm-alert-dialog-header>
											<h2 hlmAlertDialogTitle
												class="cli-display-font text-white text-lg font-bold">
												¿Aprobar esta tarea?</h2>
											<p hlmAlertDialogDescription
												class="text-neutral-500 text-sm leading-relaxed">
												Confirma que deseas aprobar esta tarea. Una vez confirmada, el estado
												será permanente.
											</p>
										</hlm-alert-dialog-header>
										<hlm-alert-dialog-footer class="flex gap-3">
											<button hlmAlertDialogAction (click)="ctx.close()"
												(click)="approveTask(task.id_cliente_tarea)"
												class="px-5 py-2.5 text-xs font-semibold rounded-xl bg-indigo-600 text-white hover:bg-indigo-500 shadow-lg shadow-indigo-600/15 transition-all flex items-center gap-2 hover:cursor-pointer">
												<iconify-icon icon="lucide:check" width="14"></iconify-icon>
												Confirmar
											</button>
											<button hlmAlertDialogCancel (click)="ctx.close()"
												class="px-5 py-2.5 text-xs font-medium rounded-xl bg-white/[0.03] text-neutral-400 border border-white/[0.08] hover:bg-white/[0.06] hover:text-neutral-300 transition-all">
												Cancelar
											</button>
										</hlm-alert-dialog-footer>
									</hlm-alert-dialog-content>
								</hlm-alert-dialog>
								<button (click)="rejectTask(task.id_cliente_tarea)"
									class="px-3 py-1.5 text-[10px] font-bold uppercase tracking-wider rounded-lg bg-red-500/10 text-red-400 border border-red-500/20 hover:bg-red-500/20 transition-all flex items-center gap-1.5 whitespace-nowrap hover:cursor-pointer">
									<iconify-icon icon="lucide:x" width="12"></iconify-icon>
									Rechazar
								</button>
								} @else {
								<span class="text-[9px] text-neutral-700 italic">—</span>
								}
							</div>
						</div>
						}
						} @else {
						<!-- No Tasks -->
						<div class="flex flex-col items-center justify-center py-16 gap-3">
							<div
								class="w-12 h-12 rounded-2xl bg-white/[0.02] border border-white/[0.05] flex items-center justify-center">
								<iconify-icon icon="lucide:inbox" width="24" class="text-neutral-700"></iconify-icon>
							</div>
							<p class="text-[11px] text-neutral-600 font-medium">Sin tareas asignadas</p>
						</div>
						}
					</div>
				</div>
			</div>
		</div>
		}

		@empty {
		<!-- Empty State -->
		<div class="py-24 flex flex-col items-center gap-5">
			<div class="w-20 h-20 rounded-3xl bg-white/[0.02] border border-white/5 flex items-center justify-center">
				<iconify-icon icon="lucide:users-x" width="40" class="text-neutral-700"></iconify-icon>
			</div>
			<div class="text-center space-y-1">
				<h3 class="cli-display-font text-lg font-bold text-neutral-400">Sin resultados</h3>
				<p class="text-sm text-neutral-600 max-w-xs leading-relaxed">No encontramos socios que coincidan con tu
					búsqueda actual.</p>
			</div>
			<button (click)="searchTerm.set(''); filterClients()"
				class="text-xs font-bold uppercase tracking-widest text-indigo-400 hover:text-indigo-300 transition-colors">
				Limpiar búsqueda
			</button>
		</div>
		}
	</div>

	<!-- Footer -->
	<div class="cli-entrance cli-entrance-delay-4 flex items-center justify-center py-2">
		<p class="text-[11px] text-neutral-600 flex items-center gap-2">
			<iconify-icon icon="lucide:database" width="12" class="text-neutral-700"></iconify-icon>
			Mostrando <span class="font-bold text-neutral-400">{{ filteredClients().length }}</span>
			de <span class="font-bold text-neutral-400">{{ clientWithTasks().length }}</span> socios
		</p>
	</div>
</div>