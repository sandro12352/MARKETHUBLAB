<div class="max-w-6xl mr-auto ml-auto pt-8 pr-8 pb-8 pl-8 space-y-8">
	<!-- Header Section -->
	<div class="flex flex-col md:flex-row md:items-end gap-x-4 gap-y-4 justify-between">
		<div>
			<h1 class="text-3xl font-semibold tracking-tight mb-2 text-white">Nuestros Socios</h1>
			<p class="text-sm text-neutral-400">Aquí puedes gestionar a tus socios de marketing.</p>
		</div>
		<div class="flex gap-3">
			<button
				class="px-4 py-2 text-xs font-medium border rounded-lg transition-colors flex items-center gap-2 text-neutral-300 bg-white/5 border-white/5 hover:bg-white/10">
				<iconify-icon icon="lucide:filter" width="14"></iconify-icon>
				Filtrar
			</button>
			<button
				class="px-4 py-2 text-xs font-medium hover:bg-indigo-500 border border-transparent rounded-lg shadow-lg transition-all flex items-center gap-2 text-white bg-indigo-600 shadow-indigo-900/20">
				<iconify-icon icon="lucide:plus" width="14"></iconify-icon>
				Nuevo Socio
			</button>
		</div>
	</div>

	<!-- Table Section -->
	<div
		class="rounded-xl overflow-hidden border border-white/5 bg-gradient-to-br from-white/[0.03] to-white/[0.01] backdrop-blur-sm">
		<!-- Table Header -->
		<div class="px-6 py-4 border-b border-white/5 bg-white/[0.02]">
			<h2 class="text-sm font-semibold text-neutral-300 flex items-center gap-2">
				<iconify-icon icon="lucide:users" width="16" class="text-indigo-400"></iconify-icon>
				Lista de Socios
			</h2>
		</div>

		<!-- Table Content -->
		<div hlmTableContainer class="overflow-hidden">
			<table hlmTable class="w-full">
				<thead hlmTHead>
					<tr hlmTr class="border-b border-white/5 hover:bg-white/[0.02] transition-colors">
						<th hlmTh class="w-12">
							<label class="relative flex items-center justify-center cursor-pointer p-1">
								<input type="checkbox" class="peer sr-only">
								<div
									class="w-5 h-5 border rounded-md peer-checked:bg-indigo-600 peer-checked:border-indigo-600 border-neutral-600">
								</div>
								<iconify-icon icon="lucide:check"
									class="absolute opacity-0 peer-checked:opacity-100 text-xs pointer-events-none text-white"></iconify-icon>
							</label>
						</th>
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Nombre</th>
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Estado</th>
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Contacto</th>
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Moneda</th>
						<th hlmTh
							class="text-right px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Acciones</th>
					</tr>
				</thead>
				<tbody hlmTBody>
					@for (invoice of _invoices; track invoice.invoice) {
					<!-- Fila principal del cliente -->
					<tr hlmTr
						class="border-b border-white/5 hover:bg-white/[0.02] transition-colors group cursor-pointer"
						(click)="toggleRowExpand(invoice.invoice)">
						<td hlmTd class="w-12">
							<label class="relative flex items-center justify-center cursor-pointer p-1"
								(click)="$event.stopPropagation()">
								<input type="checkbox" class="peer sr-only">
								<div
									class="w-5 h-5 border rounded-md peer-checked:bg-indigo-600 peer-checked:border-indigo-600 border-neutral-600">
								</div>
								<iconify-icon icon="lucide:check"
									class="absolute opacity-0 peer-checked:opacity-100 text-xs pointer-events-none text-white"></iconify-icon>
							</label>
						</td>
						<td hlmTd class="px-6 py-4">
							<div class="flex items-center gap-3">
								<div
									class="w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-semibold">
									{{ invoice.invoice.charAt(0) }}
								</div>
								<div>
									<p class="text-sm font-medium text-white">{{ invoice.invoice }}</p>
									<p class="text-xs text-neutral-500">Socio Activo</p>
								</div>
							</div>
						</td>
						<td hlmTd class="px-6 py-4">
							<span
								class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium transition-all"
								[ngClass]="{
									'bg-green-500/10 text-green-400 border border-green-500/20': invoice.paymentStatus === 'Paid',
									'bg-yellow-500/10 text-yellow-400 border border-yellow-500/20': invoice.paymentStatus === 'Pending',
									'bg-red-500/10 text-red-400 border border-red-500/20': invoice.paymentStatus === 'Unpaid'
								}">
								{{ invoice.paymentStatus }}
							</span>
						</td>
						<td hlmTd class="px-6 py-4">
							<p class="text-sm text-neutral-300">{{ invoice.paymentMethod }}</p>
						</td>
						<td hlmTd class="px-6 py-4">
							<p class="text-sm font-medium text-white">{{ invoice.totalAmount }}</p>
						</td>
						<td hlmTd class="px-6 py-4 text-right">
							<div class="flex items-center justify-end gap-2">
								<!-- Indicador de tareas -->
								@if ((invoice.tasks?.length || 0) > 0) {
								<div
									class="flex items-center gap-1 px-2 py-1 rounded-lg bg-blue-500/10 border border-blue-500/20">
									<iconify-icon icon="lucide:tasks" width="14" class="text-blue-400"></iconify-icon>
									<span class="text-xs font-medium text-blue-400">{{ invoice.tasks?.length }}</span>
								</div>
								}
								<!-- Botón expandir -->
								<button
									class="inline-flex items-center justify-center w-8 h-8 rounded-lg text-neutral-400 hover:bg-white/5 hover:text-neutral-300 transition-all"
									[class.rotate-180]="isRowExpanded(invoice.invoice)">
									<iconify-icon icon="lucide:chevron-down" width="16"></iconify-icon>
								</button>
							</div>
						</td>
					</tr>

					<!-- Fila expandida con tareas -->
					<tr hlmTr class="border-b border-white/10 bg-white/[0.01] transition-all duration-300 ease-in-out">
						<div class="overflow-hidden transition-all duration-300 ease-in-out" [ngClass]="{
								'max-h-0 opacity-0': !isRowExpanded(invoice.invoice),
								'max-h-[600px] opacity-100': isRowExpanded(invoice.invoice)
							}">
						
						</div>
						<td hlmTd [attr.colSpan]="6" class="p-0">
							<div class="overflow-hidden transition-all duration-300 ease-in-out" [ngClass]="{
								'max-h-0 opacity-0': !isRowExpanded(invoice.invoice),
								'max-h-[600px] opacity-100': isRowExpanded(invoice.invoice)
							}">
								<h3 class="text-sm font-semibold text-neutral-300 flex items-center gap-2">
									<iconify-icon icon="lucide:checklist" width="16"
										class="text-indigo-400"></iconify-icon>
									Tareas del Cliente
								</h3>

								<!-- Lista de tareas -->
								<div class="space-y-2 max-h-96 overflow-y-auto">
									@for (task of invoice.tasks; track task.id) {
									<div
										class="p-4 rounded-lg bg-white/[0.02] border border-white/5 hover:border-white/10 transition-all">
										<div class="flex items-start justify-between gap-4">
											<div class="flex-1 min-w-0">
												<div class="flex items-center gap-2 mb-1">
													<p class="text-sm font-medium text-white">{{ task.title }}</p>
													<span
														class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-semibold transition-all"
														[ngClass]="{
															'bg-yellow-500/10 text-yellow-400 border border-yellow-500/20': task.status === 'pending',
															'bg-green-500/10 text-green-400 border border-green-500/20': task.status === 'approved',
															'bg-red-500/10 text-red-400 border border-red-500/20': task.status === 'rejected'
														}">
														{{ task.status === 'pending' ? 'Pendiente' : task.status ===
														'approved' ? 'Aprobada' : 'Rechazada' }}
													</span>
												</div>
												<p class="text-xs text-neutral-400 mb-2">{{ task.description }}</p>
												<div class="flex items-center gap-4 text-xs text-neutral-500">
													<span class="flex items-center gap-1">
														<iconify-icon icon="lucide:calendar" width="12"></iconify-icon>
														Vence: {{ task.dueDate }}
													</span>
													@if (task.completedDate) {
													<span class="flex items-center gap-1">
														<iconify-icon icon="lucide:check-circle-2" width="12"
															class="text-green-400"></iconify-icon>
														Completada: {{ task.completedDate }}
													</span>
													}
													@if (task.reviewer) {
													<span class="flex items-center gap-1">
														<iconify-icon icon="lucide:user-check" width="12"
															class="text-indigo-400"></iconify-icon>
														Revisado por: {{ task.reviewer }}
													</span>
													}
												</div>
											</div>

											<!-- Acciones -->
											@if (task.status === 'pending') {
											<div class="flex items-center gap-2 flex-shrink-0">
												<button (click)="approveTask(task.id)"
													class="px-3 py-2 text-xs font-medium rounded-lg bg-green-500/10 text-green-400 border border-green-500/20 hover:bg-green-500/20 transition-all flex items-center gap-1">
													<iconify-icon icon="lucide:check" width="14"></iconify-icon>
													Aprobar
												</button>
												<button (click)="rejectTask(task.id)"
													class="px-3 py-2 text-xs font-medium rounded-lg bg-red-500/10 text-red-400 border border-red-500/20 hover:bg-red-500/20 transition-all flex items-center gap-1">
													<iconify-icon icon="lucide:x" width="14"></iconify-icon>
													Rechazar
												</button>
											</div>
											}
											@if (task.status !== 'pending') {
											<div class="text-right flex-shrink-0">
												<p class="text-xs text-neutral-500">{{ task.status === 'approved' ?
													'Aprobada' : 'Rechazada' }}</p>
											</div>
											}
										</div>
									</div>
									}
								</div>

								<!-- Resumen de tareas -->
								<div class="grid grid-cols-3 gap-2 mt-4 pt-4 border-t border-white/5">
									<div class="p-2 rounded-lg bg-yellow-500/5 text-center">
										<p class="text-xs text-neutral-400">Pendientes</p>
										<p class="text-sm font-semibold text-yellow-400">{{
											getTaskStats(invoice).pending }}</p>
									</div>
									<div class="p-2 rounded-lg bg-green-500/5 text-center">
										<p class="text-xs text-neutral-400">Aprobadas</p>
										<p class="text-sm font-semibold text-green-400">{{
											getTaskStats(invoice).approved }}</p>
									</div>
									<div class="p-2 rounded-lg bg-red-500/5 text-center">
										<p class="text-xs text-neutral-400">Rechazadas</p>
										<p class="text-sm font-semibold text-red-400">{{ getTaskStats(invoice).rejected
											}}</p>
									</div>
								</div>
							</div>
						</td>
					</tr>
					}
				
				</tbody>
			</table>
		</div>

		<!-- Table Footer -->
		<div class="px-6 py-4 border-t border-white/5 bg-white/[0.01] flex items-center justify-between">
			<p class="text-xs text-neutral-500">Mostrando <span class="font-semibold text-neutral-400">{{
					_invoices.length }}</span> socios</p>
			<div class="flex items-center gap-2">
				<button
					class="p-2 rounded-lg text-neutral-400 hover:bg-white/5 hover:text-neutral-300 transition-all disabled:opacity-50">
					<iconify-icon icon="lucide:chevron-left" width="16"></iconify-icon>
				</button>
				<span class="text-xs text-neutral-500">Página <span class="font-semibold text-neutral-400">1</span> de
					<span class="font-semibold text-neutral-400">5</span></span>
				<button class="p-2 rounded-lg text-neutral-400 hover:bg-white/5 hover:text-neutral-300 transition-all">
					<iconify-icon icon="lucide:chevron-right" width="16"></iconify-icon>
				</button>
			</div>
		</div>
	</div>
</div>