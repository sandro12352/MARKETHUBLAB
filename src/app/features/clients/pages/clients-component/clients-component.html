<div class="max-w-6xl mr-auto ml-auto pt-8 pr-8 pb-8 pl-8 space-y-8">
	<!-- Header Section -->
	<div class="flex flex-col md:flex-row md:items-end gap-x-4 gap-y-4 justify-between">
		<div>
			<h1 class="text-3xl font-semibold tracking-tight mb-2 text-white">Nuestros Socios</h1>
			<p class="text-sm text-neutral-400">AquÃ­ puedes gestionar a tus socios de marketing.</p>
		</div>
		<div class="flex gap-3">
			<button
				class="px-4 py-2 text-xs font-medium border rounded-lg transition-colors flex items-center gap-2 text-neutral-300 bg-white/5 border-white/5 hover:bg-white/10">
				<iconify-icon icon="lucide:filter" width="14"></iconify-icon>
				Filtrar
			</button>
			<button
				class="px-4 py-2 text-xs font-medium hover:bg-indigo-500 border border-transparent rounded-lg shadow-lg transition-all flex items-center gap-2 text-white bg-indigo-600 shadow-indigo-900/20">
				<iconify-icon icon="lucide:plus" width="14"></iconify-icon>
				Nuevo Socio
			</button>
		</div>
	</div>

	<!-- Table Section -->
	<div
		class="rounded-xl overflow-hidden border border-white/5 bg-linear-to-br from-white/3 to-white/1 backdrop-blur-sm">
		<!-- Table Header -->
		<div class="px-6 py-4 border-b border-white/5 bg-white/2">
			<h2 class="text-sm font-semibold text-neutral-300 flex items-center gap-2">
				<iconify-icon icon="lucide:users" width="16" class="text-indigo-400"></iconify-icon>
				Lista de Socios
			</h2>
		</div>

		<!-- Table Content -->
		<div hlmTableContainer class="overflow-auto">
			<table hlmTable class="w-full min-w-max">
				<thead hlmTHead>
					<tr hlmTr class="border-b border-white/5 hover:bg-white/2 transition-colors">
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Nombre</th>
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Dni</th>
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Contacto</th>
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Fecha Registro</th>
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Fecha Nacimiento</th>
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Aniversario</th>
						<th hlmTh
							class="text-left px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Redes</th>
						<th hlmTh
							class="text-right w-12 px-6 py-4 text-xs font-semibold text-neutral-400 uppercase tracking-wider">
							Acciones
						</th>
					</tr>
				</thead>
				<tbody hlmTBody>
					@for (item of clientWithTasks(); track item.cliente.id_cliente) {
					<!-- Fila principal del cliente -->
					<tr hlmTr class="border-b border-white/5 hover:bg-white/2 transition-colors group"
						>
						<td hlmTd class="px-6 py-4">
							<div class="flex items-center gap-3">
								<div
									class="w-8 h-8 rounded-lg bg-linear-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white text-xs font-semibold">
									{{ item.cliente.nombres.charAt(0) }}
								</div>
								<div>
									<p class="text-sm font-medium text-white">{{ item.cliente.nombres }} {{
										item.cliente.apellidos
										}}</p>
									<p class="text-xs text-neutral-500">{{item.cliente.nombre_empresa || "Empresa"}}</p>
								</div>
							</div>
						</td>

						<td hlmTd class="px-6 py-4">
							<p class="text-sm font-medium text-white">{{ item.cliente.dni || 'Sin DNI' }}</p>
						</td>
						<td hlmTd class="px-6 py-4">
							<p class="text-sm text-neutral-300">{{ item.cliente.telefono}}</p>
						</td>
						<td hlmTd class="px-6 py-4">
							<p class="text-sm font-medium text-white">{{ item.cliente.fecha_registro |
								date:'dd/MM/yyyy':'UTC'
								}}</p>
						</td>
						<td hlmTd class="px-6 py-4">
							<p class="text-sm font-medium text-white">{{ item.cliente.fecha_nacimiento |
								date:'dd/MM/yyyy':'UTC' }}</p>
						</td>
						<td hlmTd class="px-6 py-4">
							<p class="text-sm font-medium text-white">{{ item.cliente.fecha_aniversario |
								date:'dd/MM/yyyy':'UTC' }}</p>
						</td>
						<td hlmTd class="px-6 py-4">
							<div class="flex items-center gap-2">
								<a [href]="item.cliente.tiktok" target="_blank"><iconify-icon icon="lucide:music-2" width="16"
										class="text-blue-300"></iconify-icon></a>
								<a [href]="item.cliente.instagram" target="_blank"><iconify-icon icon="lucide:instagram" width="16"
										class="text-pink-400"></iconify-icon></a>
							</div>
						</td>
						<td hlmTd class="px-6 py-4 text-right">
							<div class="flex items-center justify-end gap-2">
								<!-- Indicador de tareas -->
								@if ((item.tareas.length || 0) > 0) {
								<div
									class="flex items-center gap-1 px-2 py-1 rounded-lg bg-blue-500/10 border border-blue-500/20">
									<iconify-icon icon="lucide:tasks" width="14" class="text-blue-400"></iconify-icon>
									<span class="text-xs font-medium text-blue-400">{{ item.tareas.length }}</span>
								</div>
								}
								<!-- BotÃ³n expandir -->
								<button
								(click)="toggleRowExpand(item.cliente.id_cliente)"
									class="inline-flex items-center justify-center w-8 h-8 rounded-lg text-neutral-400 hover:bg-white/5 hover:text-neutral-300 transition-all hover:cursor-pointer"
									[class.rotate-180]="isRowExpanded(item.cliente.id_cliente)">
									<iconify-icon icon="lucide:chevron-down" width="16"></iconify-icon>
								</button>
							</div>
						</td>
					</tr>

					<!-- Fila expandida con tareas -->
					<tr hlmTr class="border-b border-white/10 bg-white/1">
						<td hlmTd [attr.colSpan]="9" class="p-0">
							<div class="overflow-hidden transition-all duration-300 ease-in-out" [ngClass]="{
        'max-h-0 opacity-0': !isRowExpanded(item.cliente.id_cliente),
        'max-h-200 opacity-100': isRowExpanded(item.cliente.id_cliente)
      }">
								<div class="px-6 py-4 space-y-4">
									<!-- TÃ­tulo de tareas -->
									<h3 class="text-sm font-semibold text-neutral-300 flex items-center gap-2">
										<iconify-icon icon="lucide:checklist" width="16"
											class="text-indigo-400"></iconify-icon>
										Tareas del Cliente
									</h3>

									<!-- Lista de tareas -->
									<div class="space-y-3 max-h-96 overflow-y-auto pr-2">
										@for (task of item.tareas; track task.id_tarea) {
										<div
											class="p-4 rounded-lg bg-white/2 border border-white/5 hover:border-white/10 transition-all">
											<div class="flex items-start justify-between gap-4">
												<div class="flex-1 min-w-0">
													<div class="flex items-center gap-2 mb-2 flex-wrap">
														<div>
															<p class="text-sm font-medium text-white">{{ task.nombre }}
															</p>

														</div>
														<span
															class="inline-flex items-center px-2 py-0.5 rounded text-[10px] font-semibold transition-all whitespace-nowrap"
															[ngClass]="{
        'bg-blue-500/10 text-blue-400 border border-blue-500/20': task.estado === 'subido',
        'bg-green-500/10 text-green-400 border border-green-500/20': task.estado === 'aprobado',
        'bg-red-500/10 text-red-400 border border-red-500/20': task.estado === 'rechazado',
        'bg-gray-500/10 text-gray-400 border border-gray-500/20': !['subido', 'aprobado', 'rechazado'].includes(task.estado)
      }">

															{{
															task.estado === 'subido' ? 'Subido' :
															task.estado === 'aprobado' ? 'Aprobada' :
															task.estado === 'rechazado' ? 'Rechazada' : 'Pendiente'
															}}
														</span>
													</div>
													<p class="text-xs text-neutral-400 mb-3">{{ task.descripcion }}</p>

													<!-- Mostrar archivos -->
													@if (task.archivos && task.archivos.length > 0) {
													<div class="files-section">
														<h4>Archivo adjunto:</h4>
														@for (archivo of task.archivos; track
														archivo.id_archivo_cliente) {
														<div class="flex items-center content-center gap-4 mt-4">
															<a [href]="archivo.ruta" target="_blank"
																class="file-link hover:text-indigo-400 shadow-sm border border-white/5 rounded-lg px-3 py-2 bg-white/5 flex items-center gap-2 text-xs text-white mb-2 inline-block">
																ðŸ“„ Ver archivo
															</a>
															<small>Subido: {{ archivo.fecha_subida|
																date:'dd/MM/yyyy':'UTC' }}</small>

														</div>
														}
													</div>
													}

													<div class="flex flex-wrap gap-3 text-xs text-neutral-500">
														@if (task.estado === 'aprobado' ) {
														<span class="flex items-center gap-1">
															<iconify-icon icon="lucide:check-circle-2" width="12"
																class="text-green-400"></iconify-icon>
															Completada: {{ task.estado | titlecase}}
														</span>
														}
														<!-- @if (task.reviewer) {
														<span class="flex items-center gap-1">
															<iconify-icon icon="lucide:user-check" width="12"
																class="text-indigo-400"></iconify-icon>
															Revisado por: {{ task.reviewer }}
														</span>
														} -->
													</div>
												</div>

												<!-- Acciones -->
												@if (task.estado === 'subido') {
												<div class="flex items-center gap-2 shrink-0 flex-wrap justify-end">
													<hlm-alert-dialog>
														<button
															hlmAlertDialogTrigger hlmBtn
															class="px-3 py-2 text-xs font-medium rounded-lg bg-green-500/10 text-green-400 border border-green-500/20 hover:bg-green-500/20 transition-all flex items-center gap-1 whitespace-nowrap hover:cursor-pointer">
															<iconify-icon icon="lucide:check" width="14"></iconify-icon>
															Aprobar
														</button>
														<hlm-alert-dialog-content *brnAlertDialogContent="let ctx" class="border border-indigo-500/20 bg-linear-to-br from-indigo-650/30 to-purple-900/30 shadow-lg shadow-indigo-650/20">
															<hlm-alert-dialog-header>
																<h2 hlmAlertDialogTitle class="text-white text-lg font-semibold">Â¿Aprobar esta tarea?</h2>
																<p hlmAlertDialogDescription class="text-neutral-400 text-sm">
																	Confirma que deseas aprobar esta tarea. Una vez confirmada, el estado serÃ¡ permanente.
																</p>
															</hlm-alert-dialog-header>
															<hlm-alert-dialog-footer class="flex gap-3">
																<button hlmAlertDialogAction
																	(click)="ctx.close()"
																	(click)="approveTask(task.id_cliente_tarea)"
																	class="px-4 py-2 text-xs font-medium rounded-lg bg-indigo-600/25 text-indigo-300 border border-indigo-500/30 hover:bg-indigo-600/35 hover:border-indigo-500/40 shadow-lg shadow-indigo-600/10 transition-all flex items-center gap-2 hover:cursor-pointer">
																	<iconify-icon icon="lucide:check" width="14"></iconify-icon>
																	Confirmar
																</button>
																<button hlmAlertDialogCancel
																	(click)="ctx.close()"
																	class="px-4 py-2 text-xs font-medium rounded-lg bg-white/5 text-neutral-400 border border-white/10 hover:bg-indigo-600/15 hover:border-indigo-500/20 hover:text-neutral-300 transition-all">
																	Cancelar
																</button>
																
															</hlm-alert-dialog-footer>
														</hlm-alert-dialog-content>

													</hlm-alert-dialog>
													<button (click)="rejectTask(task.id_cliente_tarea)"
														class="px-3 py-2 text-xs font-medium rounded-lg bg-red-500/10 text-red-400 border border-red-500/20 hover:bg-red-500/20 transition-all flex items-center gap-1 whitespace-nowrap hover:cursor-pointer">
														<iconify-icon icon="lucide:x" width="14"></iconify-icon>
														Rechazar
													</button>
												</div>
												}
												@if (task.estado !== 'subido' && task.estado !== 'pendiente') {
												<div class="text-right shrink-0">
													<p class="text-xs text-neutral-500">{{ task.estado === 'aprobado' ?
														'Aprobada' : 'Rechazada' }}</p>
												</div>
												}
											</div>
										</div>
										}
									</div>

									<!-- Resumen de tareas -->
									<div class="grid grid-cols-3 gap-3 mt-4 pt-4 border-t border-white/5">
										<div class="p-3 rounded-lg bg-yellow-500/5 text-center">
											<p class="text-xs text-neutral-400 mb-1">Pendientes</p>
											<p class="text-sm font-semibold text-yellow-400">{{
												getTaskStats(item.tareas).pendiente }}</p>
										</div>
										<div class="p-3 rounded-lg bg-green-500/5 text-center">
											<p class="text-xs text-neutral-400 mb-1">Aprobadas</p>
											<p class="text-sm font-semibold text-green-400">{{
												getTaskStats(item.tareas).aprobado }}</p>
										</div>
										<div class="p-3 rounded-lg bg-red-500/5 text-center">
											<p class="text-xs text-neutral-400 mb-1">Rechazadas</p>
											<p class="text-sm font-semibold text-red-400">{{
												getTaskStats(item.tareas).rechazado
												}}</p>
										</div>
									</div>
								</div>
							</div>
						</td>
					</tr>
					}
				</tbody>
			</table>
		</div>

		<!-- Table Footer -->
		<div class="px-6 py-4 border-t border-white/5 bg-white/1 flex items-center justify-between">
			<p class="text-xs text-neutral-500">Mostrando <span class="font-semibold text-neutral-400">{{
					clientWithTasks().length }}</span> socios</p>
			<div class="flex items-center gap-2">
				<button
					class="p-2 rounded-lg text-neutral-400 hover:bg-white/5 hover:text-neutral-300 transition-all disabled:opacity-50">
					<iconify-icon icon="lucide:chevron-left" width="16"></iconify-icon>
				</button>
				<span class="text-xs text-neutral-500">PÃ¡gina <span class="font-semibold text-neutral-400">1</span> de
					<span class="font-semibold text-neutral-400">5</span></span>
				<button class="p-2 rounded-lg text-neutral-400 hover:bg-white/5 hover:text-neutral-300 transition-all">
					<iconify-icon icon="lucide:chevron-right" width="16"></iconify-icon>
				</button>
			</div>
		</div>
	</div>
</div>