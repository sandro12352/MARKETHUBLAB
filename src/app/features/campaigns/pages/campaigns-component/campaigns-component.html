<div class="max-w-7xl mx-auto p-8 space-y-8">

    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold tracking-tight text-white flex items-center gap-3">
                <iconify-icon icon="lucide:megaphone" width="32" class="text-indigo-400"></iconify-icon>
                Campañas
            </h1>
            <p class="text-neutral-400 text-sm mt-1">Gestiona tus campañas publicitarias, conjuntos de anuncios y
                creatividades.</p>
        </div>

        <hlm-alert-dialog>
            <button hlmBtn hlmAlertDialogTrigger (click)="resetForm()"
                class="px-5 py-2.5 text-sm font-medium hover:bg-indigo-500 border border-transparent rounded-xl shadow-lg transition-all flex items-center gap-2 text-white bg-indigo-600 shadow-indigo-900/20 hover:shadow-indigo-900/30 hover:cursor-pointer">
                <iconify-icon icon="lucide:plus" width="18"></iconify-icon>
                Nueva Campaña
            </button>

            <!-- Create/Edit Campaign Dialog -->
            <hlm-alert-dialog-content class="sm:max-w-[600px]" *brnAlertDialogContent="let ctx">
                <hlm-alert-dialog-header>
                    <h3 hlmAlertDialogTitle class="text-white text-xl font-bold">
                        {{ selectedCampaign() ? 'Editar Campaña' : 'Crear Nueva Campaña' }}
                    </h3>
                    <p hlmAlertDialogDescription class="text-neutral-400">
                        {{ selectedCampaign() ? 'Actualiza la información de tu campaña.' : 'Configura los detalles de
                        tu nueva campaña publicitaria.' }}
                    </p>
                </hlm-alert-dialog-header>

                <form [formGroup]="campaignForm" (ngSubmit)="onSubmitCampaign(ctx)" class="space-y-5 py-4">
                    <!-- Nombre -->
                    <div class="space-y-2">
                        <label hlmLabel for="campaign-name" class="text-neutral-300">Nombre de la campaña</label>
                        <input hlmInput id="campaign-name" formControlName="nombre" type="text"
                            placeholder="Ej: Black Friday 2026, Lanzamiento Producto..."
                            class="w-full bg-white/5 border-white/10" />
                        @if (campaignForm.get('nombre')?.touched && campaignForm.get('nombre')?.invalid) {
                        <p class="text-red-400 text-xs italic">El nombre es requerido (mínimo 3 caracteres).</p>
                        }
                    </div>

                    <!-- Objetivo -->
                    <div class="space-y-2">
                        <label hlmLabel for="campaign-objective" class="text-neutral-300">Objetivo</label>
                        <brn-select formControlName="objetivo" placeholder="Selecciona un objetivo">
                            <hlm-select-trigger class="w-full bg-white/5 border-white/10 text-white h-10 rounded-lg">
                                <hlm-select-value />
                            </hlm-select-trigger>
                            <hlm-select-content class="bg-neutral-900 border-white/10">
                                <hlm-option value="OUTCOME_AWARENESS"
                                    class="text-neutral-300 focus:bg-white/10">Reconocimiento</hlm-option>
                                <hlm-option value="OUTCOME_TRAFFIC"
                                    class="text-neutral-300 focus:bg-white/10">Tráfico</hlm-option>
                                <hlm-option value="OUTCOME_ENGAGEMENT"
                                    class="text-neutral-300 focus:bg-white/10">Interacción</hlm-option>
                                <hlm-option value="OUTCOME_LEADS" class="text-neutral-300 focus:bg-white/10">Clientes
                                    Potenciales</hlm-option>
                                <hlm-option value="OUTCOME_SALES"
                                    class="text-neutral-300 focus:bg-white/10">Ventas</hlm-option>
                                <hlm-option value="OUTCOME_APP_PROMOTION"
                                    class="text-neutral-300 focus:bg-white/10">Promoción de App</hlm-option>
                            </hlm-select-content>
                        </brn-select>
                    </div>
                </form>

                <hlm-alert-dialog-footer>
                    <button hlmBtn variant="ghost" (click)="ctx.close(); resetForm()"
                        class="text-neutral-400 hover:text-white">Cancelar</button>
                    <button hlmBtn [disabled]="campaignForm.invalid || isSubmitting()" (click)="onSubmitCampaign(ctx)"
                        class="bg-indigo-600 hover:bg-indigo-500 text-white border-none shadow-lg shadow-indigo-500/20 w-28">
                        @if (isSubmitting()) {
                        <iconify-icon icon="lucide:loader-2" class="animate-spin" width="18"></iconify-icon>
                        } @else {
                        {{ selectedCampaign() ? 'Guardar' : 'Crear' }}
                        }
                    </button>
                </hlm-alert-dialog-footer>
            </hlm-alert-dialog-content>
        </hlm-alert-dialog>
    </div>

    <!-- Stats Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div
            class="rounded-xl bg-linear-to-br from-indigo-500/10 to-indigo-500/5 border border-indigo-500/20 p-5 hover:border-indigo-500/40 transition-all">
            <div class="flex items-center gap-3 mb-3">
                <div
                    class="w-10 h-10 rounded-lg bg-indigo-500/20 flex items-center justify-center border border-indigo-500/30">
                    <iconify-icon icon="lucide:layers" width="20" class="text-indigo-400"></iconify-icon>
                </div>
                <p class="text-xs text-neutral-400 uppercase tracking-wider font-medium">Total</p>
            </div>
            <p class="text-3xl font-bold text-white">{{ getCampaignStats().total }}</p>
        </div>

        <div
            class="rounded-xl bg-linear-to-br from-green-500/10 to-green-500/5 border border-green-500/20 p-5 hover:border-green-500/40 transition-all">
            <div class="flex items-center gap-3 mb-3">
                <div
                    class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center border border-green-500/30">
                    <iconify-icon icon="lucide:play-circle" width="20" class="text-green-400"></iconify-icon>
                </div>
                <p class="text-xs text-neutral-400 uppercase tracking-wider font-medium">Activas</p>
            </div>
            <p class="text-3xl font-bold text-white">{{ getCampaignStats().activas }}</p>
        </div>

        <div
            class="rounded-xl bg-linear-to-br from-yellow-500/10 to-yellow-500/5 border border-yellow-500/20 p-5 hover:border-yellow-500/40 transition-all">
            <div class="flex items-center gap-3 mb-3">
                <div
                    class="w-10 h-10 rounded-lg bg-yellow-500/20 flex items-center justify-center border border-yellow-500/30">
                    <iconify-icon icon="lucide:pause-circle" width="20" class="text-yellow-400"></iconify-icon>
                </div>
                <p class="text-xs text-neutral-400 uppercase tracking-wider font-medium">Pausadas</p>
            </div>
            <p class="text-3xl font-bold text-white">{{ getCampaignStats().pausadas }}</p>
        </div>

        <div
            class="rounded-xl bg-linear-to-br from-purple-500/10 to-purple-500/5 border border-purple-500/20 p-5 hover:border-purple-500/40 transition-all">
            <div class="flex items-center gap-3 mb-3">
                <div
                    class="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center border border-purple-500/30">
                    <iconify-icon icon="lucide:wallet" width="20" class="text-purple-400"></iconify-icon>
                </div>
                <p class="text-xs text-neutral-400 uppercase tracking-wider font-medium">Presupuesto</p>
            </div>
        </div>
    </div>

    <!-- Search & Filter Bar -->
    <div
        class="flex flex-col md:flex-row items-stretch md:items-center gap-4 p-4 rounded-xl bg-white/5 border border-white/10">
        <div class="relative flex-1">
            <iconify-icon icon="lucide:search" width="16"
                class="absolute left-3 top-1/2 -translate-y-1/2 text-neutral-500"></iconify-icon>
            <input hlmInput type="text" placeholder="Buscar campaña por nombre, plataforma u objetivo..."
                (input)="onSearch($event)"
                class="w-full pl-10 bg-white/5 border-white/10 h-10 rounded-lg text-sm text-white placeholder:text-neutral-500" />
        </div>
        <div class="flex gap-2 flex-wrap">
            <button hlmBtn variant="ghost" (click)="setFilter('todas')" [ngClass]="{
                    'bg-indigo-600/20 text-indigo-300 border-indigo-500/30': activeFilter() === 'todas',
                    'text-neutral-400 hover:text-white hover:bg-white/5': activeFilter() !== 'todas'
                }" class="px-3 py-1.5 text-xs rounded-lg border border-transparent transition-all">
                Todas
            </button>
            <button hlmBtn variant="ghost" (click)="setFilter('activa')" [ngClass]="{
                    'bg-green-600/20 text-green-300 border-green-500/30': activeFilter() === 'activa',
                    'text-neutral-400 hover:text-white hover:bg-white/5': activeFilter() !== 'activa'
                }" class="px-3 py-1.5 text-xs rounded-lg border border-transparent transition-all">
                Activas
            </button>
            <button hlmBtn variant="ghost" (click)="setFilter('PAUSED')" [ngClass]="{
                    'bg-yellow-600/20 text-yellow-300 border-yellow-500/30': activeFilter() === 'PAUSED',
                    'text-neutral-400 hover:text-white hover:bg-white/5': activeFilter() !== 'PAUSED'
                }" class="px-3 py-1.5 text-xs rounded-lg border border-transparent transition-all">
                Pausadas
            </button>
            <button hlmBtn variant="ghost" (click)="setFilter('borrador')" [ngClass]="{
                    'bg-neutral-600/20 text-neutral-300 border-neutral-500/30': activeFilter() === 'borrador',
                    'text-neutral-400 hover:text-white hover:bg-white/5': activeFilter() !== 'borrador'
                }" class="px-3 py-1.5 text-xs rounded-lg border border-transparent transition-all">
                Borradores
            </button>
            <button hlmBtn variant="ghost" (click)="setFilter('finalizada')" [ngClass]="{
                    'bg-blue-600/20 text-blue-300 border-blue-500/30': activeFilter() === 'finalizada',
                    'text-neutral-400 hover:text-white hover:bg-white/5': activeFilter() !== 'finalizada'
                }" class="px-3 py-1.5 text-xs rounded-lg border border-transparent transition-all">
                Finalizadas
            </button>
        </div>
    </div>

    <!-- Loading State -->
    @if (isLoading()) {
    <div class="flex items-center justify-center py-20">
        <div class="text-center space-y-4">
            <div class="w-12 h-12 rounded-full border-2 border-indigo-500/20 border-t-indigo-500 animate-spin mx-auto">
            </div>
            <p class="text-neutral-400">Cargando campañas...</p>
        </div>
    </div>
    } @else {

    <!-- Campaigns Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
        @for (campaign of filteredCampaigns(); track campaign.id_campana) {
        <div
            class="group relative rounded-2xl bg-linear-to-br from-white/8 to-white/2 border border-white/10 p-6 hover:border-indigo-500/50 transition-all duration-300 hover:shadow-[0_0_40px_-10px_rgba(99,102,241,0.2)] flex flex-col hover:-translate-y-1.5 overflow-hidden">

            <!-- Background Decorative Glow -->
            <div
                class="absolute -top-24 -right-24 w-48 h-48 bg-indigo-500/10 rounded-full blur-3xl group-hover:bg-indigo-500/20 transition-colors duration-500">
            </div>

            <!-- Card Header -->
            <div class="flex items-start justify-between mb-6 relative z-10">
                <div class="flex items-center gap-4 min-w-0">
                    <div
                        class="w-14 h-14 rounded-xl bg-linear-to-br from-indigo-500/20 to-purple-500/20 border border-indigo-500/30 flex items-center justify-center shadow-lg shadow-indigo-500/10 group-hover:from-indigo-500/30 group-hover:to-purple-500/30 transition-all duration-500 shrink-0">
                        <iconify-icon icon="lucide:megaphone" width="28"
                            class="text-indigo-400 group-hover:scale-110 transition-transform"></iconify-icon>
                    </div>
                    <div class="min-w-0">
                        <h3
                            class="text-white font-bold text-xl group-hover:text-indigo-300 transition-colors line-clamp-1 mb-1">
                            {{ campaign.name }}
                        </h3>
                        <div class="flex items-center gap-2">
                            <span [ngClass]="getStatusColor(campaign.status)"
                                class="inline-block px-2 py-0.5 rounded-lg border text-[10px] font-semibold uppercase tracking-wider">
                                {{ getStatusLabel(campaign.status) }}
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Actions Menu -->
                <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <button hlmBtn variant="ghost" size="sm" class="h-8 w-8 p-0 rounded-full hover:bg-white/10"
                        [hlmDropdownMenuTrigger]="campaignMenu">
                        <iconify-icon icon="lucide:more-vertical" width="18" class="text-neutral-400"></iconify-icon>
                    </button>

                    <ng-template #campaignMenu>
                        <hlm-dropdown-menu class="w-48 bg-neutral-950 border-white/10">
                            <hlm-alert-dialog>
                                <button hlmDropdownMenuItem hlmAlertDialogTrigger (click)="editCampaign(campaign)"
                                    class="w-full hover:bg-white/5 cursor-pointer">
                                    <iconify-icon icon="lucide:edit-2" width="14"
                                        class="mr-2 text-amber-400"></iconify-icon>
                                    <span class="text-neutral-300">Editar</span>
                                </button>
                                <hlm-alert-dialog-content class="sm:max-w-[600px]" *brnAlertDialogContent="let ctx">
                                    <hlm-alert-dialog-header>
                                        <h3 hlmAlertDialogTitle class="text-white text-xl font-bold">Editar
                                            Campaña</h3>
                                        <p hlmAlertDialogDescription class="text-neutral-400">Actualiza la
                                            información de tu campaña.</p>
                                    </hlm-alert-dialog-header>
                                    <form [formGroup]="campaignForm" class="space-y-5 py-4">
                                        <div class="space-y-2">
                                            <label hlmLabel class="text-neutral-300">Nombre</label>
                                            <input hlmInput formControlName="nombre" type="text"
                                                class="w-full bg-white/5 border-white/10" />
                                        </div>
                                        <div class="space-y-2">
                                            <label hlmLabel class="text-neutral-300">Objetivo</label>
                                            <brn-select formControlName="objetivo" placeholder="Selecciona un objetivo">
                                                <hlm-select-trigger
                                                    class="w-full bg-white/5 border-white/10 text-white h-10 rounded-lg">
                                                    <hlm-select-value />
                                                </hlm-select-trigger>
                                                <hlm-select-content class="bg-neutral-900 border-white/10">
                                                    <hlm-option value="OUTCOME_AWARENESS"
                                                        class="text-neutral-300 focus:bg-white/10">Reconocimiento</hlm-option>
                                                    <hlm-option value="OUTCOME_TRAFFIC"
                                                        class="text-neutral-300 focus:bg-white/10">Tráfico</hlm-option>
                                                    <hlm-option value="OUTCOME_ENGAGEMENT"
                                                        class="text-neutral-300 focus:bg-white/10">Interacción</hlm-option>
                                                    <hlm-option value="OUTCOME_LEADS"
                                                        class="text-neutral-300 focus:bg-white/10">Clientes
                                                        Potenciales</hlm-option>
                                                    <hlm-option value="OUTCOME_SALES"
                                                        class="text-neutral-300 focus:bg-white/10">Ventas</hlm-option>
                                                    <hlm-option value="OUTCOME_APP_PROMOTION"
                                                        class="text-neutral-300 focus:bg-white/10">Promoción de
                                                        App</hlm-option>
                                                </hlm-select-content>
                                            </brn-select>
                                        </div>
                                    </form>
                                    <hlm-alert-dialog-footer>
                                        <button hlmBtn variant="ghost" (click)="ctx.close(); resetForm()"
                                            class="text-neutral-400 hover:text-white">Cancelar</button>
                                        <button hlmBtn (click)="onSubmitCampaign(ctx)"
                                            [disabled]="campaignForm.invalid || isSubmitting()"
                                            class="bg-indigo-600 hover:bg-indigo-500 text-white border-none w-28">
                                            @if (isSubmitting()) {
                                            <iconify-icon icon="lucide:loader-2" class="animate-spin"
                                                width="18"></iconify-icon>
                                            } @else {
                                            {{ selectedCampaign() ? 'Guardar' : 'Crear' }}
                                            }
                                        </button>
                                    </hlm-alert-dialog-footer>
                                </hlm-alert-dialog-content>
                            </hlm-alert-dialog>
                            <hlm-dropdown-menu-separator class="bg-white/5"></hlm-dropdown-menu-separator>
                            <button hlmDropdownMenuItem (click)="deleteCampaign(campaign.id_campana!)"
                                class="text-red-400 hover:bg-red-500/10 cursor-pointer">
                                <iconify-icon icon="lucide:trash-2" width="14" class="mr-2"></iconify-icon>
                                <span>Eliminar</span>
                            </button>
                        </hlm-dropdown-menu>
                    </ng-template>
                </div>
            </div>

            <!-- Details Section -->
            <div class="space-y-4 mb-6 relative z-10">
                <div class="flex items-center gap-2 text-neutral-400 text-sm">
                    <iconify-icon icon="lucide:target" width="16" class="text-purple-400/70"></iconify-icon>
                    <span>Objetivo:</span>
                    <span class="text-neutral-200 font-medium line-clamp-1">{{ getObjectiveLabel(campaign.objective)
                        }}</span>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-2 gap-3">
                    <div
                        class="p-3 rounded-xl bg-white/5 border border-white/5 group-hover:bg-white/8 transition-colors">
                        <p class="text-[10px] text-neutral-500 uppercase tracking-widest mb-1 font-semibold">Conjuntos
                        </p>
                        <div class="flex items-center gap-2">
                            <iconify-icon icon="lucide:layers" width="14" class="text-indigo-400"></iconify-icon>
                            <p class="text-sm font-bold text-white">{{ campaign.conjuntos_anuncios?.length || 0 }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Button -->
            <div class="mt-auto pt-5 border-t border-white/5 relative z-10">
                <a [routerLink]="['/home/campaigns', campaign.id_campana]" hlmBtn variant="outline"
                    class="w-full border-white/10 text-indigo-300 hover:text-white hover:bg-indigo-600 hover:border-transparent transition-all duration-300 group/btn rounded-xl py-2 h-11 text-sm font-semibold">
                    <span>Gestionar Campaña</span>
                    <iconify-icon icon="lucide:arrow-right" width="16"
                        class="ml-2 group-hover/btn:translate-x-1 transition-transform"></iconify-icon>
                </a>
            </div>
        </div>
        } @empty {
        <!-- Empty State -->
        <div
            class="col-span-full flex flex-col items-center justify-center py-20 px-4 rounded-3xl bg-white/2 border border-dashed border-white/10">
            <div class="w-20 h-20 rounded-full bg-white/5 flex items-center justify-center mb-6">
                <iconify-icon icon="lucide:megaphone" width="40" class="text-neutral-600"></iconify-icon>
            </div>
            <h3 class="text-white font-bold text-xl mb-2 text-center">No hay campañas creadas</h3>
            <p class="text-neutral-500 text-sm text-center max-w-sm leading-relaxed">
                Comienza a crear tu primera campaña publicitaria para gestionar tus anuncios y medir resultados.
            </p>
        </div>
        }
    </div>
    }

    <hlm-toaster />
</div>